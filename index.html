<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Daily Cash Reconciliation Tool">
  <meta name="theme-color" content="#667eea">
  <title>Cash Reconciliation</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="icon-192.png">
  <!-- Chart.js for data visualization -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="app-container">

    <!-- ========== STICKY SUMMARY HEADER ========== -->
    <div class="summary-sticky" id="summarySticky">
      <div class="summary-item">
        <span class="summary-label">Total Sales</span>
        <strong class="summary-value" id="stickyTotalSales">SAR 0.00</strong>
      </div>
      <div class="summary-item">
        <span class="summary-label">Expected Cash</span>
        <strong class="summary-value" id="stickyExpectedCash">SAR 0.00</strong>
      </div>
      <div class="summary-item">
        <span class="summary-label">Actual Cash</span>
        <strong class="summary-value" id="stickyActualCash">SAR 0.00</strong>
      </div>
      <div class="summary-item difference" id="stickyDifferenceItem">
        <span class="summary-label">Difference</span>
        <strong class="summary-value" id="stickyDifference">SAR 0.00</strong>
      </div>
    </div>

    <!-- ========== MAIN HEADER ========== -->
    <header class="app-header">
      <h1>Cash Reconciliation</h1>
      <div class="keyboard-hints">
        <span class="hint"><kbd>Ctrl+S</kbd> Save</span>
        <span class="hint"><kbd>Ctrl+F</kbd> Search</span>
        <span class="hint"><kbd>F2</kbd> Fetch</span>
      </div>
    </header>

    <!-- ========== PROGRESS TRACKER ========== -->
    <div class="progress-tracker">
      <div class="progress-step active" data-step="1">
        <div class="step-circle">1</div>
        <div class="step-label">Route</div>
      </div>
      <div class="progress-connector"></div>
      <div class="progress-step" data-step="2">
        <div class="step-circle">2</div>
        <div class="step-label">Sales</div>
      </div>
      <div class="progress-connector"></div>
      <div class="progress-step" data-step="3">
        <div class="step-circle">3</div>
        <div class="step-label">Cash</div>
      </div>
      <div class="progress-connector"></div>
      <div class="progress-step" data-step="4">
        <div class="step-circle">4</div>
        <div class="step-label">Balanced</div>
      </div>
    </div>

    <!-- ========== ROUTE SELECTION & QUICK ACTIONS ========== -->
    <section class="section-card">
      <h2 class="section-title">Route & Date</h2>
      <div class="grid-2">
        <div class="input-group">
          <label class="input-label" for="routeName">Route Name</label>
          <select id="routeName" class="input-field" onchange="app.updateProgress()">
            <option value="">-- Select Route --</option>
            <option value="Al-Hasa 1">Al-Hasa 1</option>
            <option value="Al-Hasa 2">Al-Hasa 2</option>
            <option value="Al-Hasa 3">Al-Hasa 3</option>
            <option value="Al-Hasa 4">Al-Hasa 4</option>
            <option value="Al-Hasa Wholesale">Al-Hasa Wholesale</option>
          </select>
        </div>
        <div class="input-group">
          <label class="input-label" for="salesDate">Date</label>
          <input type="date" id="salesDate" class="input-field" onchange="app.updateProgress()">
        </div>
      </div>

      <div class="quick-actions">
        <button class="btn btn-primary" onclick="app.fetchInventoryData()" title="F2">
          <span class="btn-icon">üì•</span> Fetch from Inventory
        </button>
        <button class="btn btn-secondary" onclick="app.saveData()" title="Ctrl+S">
          <span class="btn-icon">üíæ</span> Save Data
        </button>
        <button class="btn btn-secondary" onclick="app.loadYesterdayCashFlow()">
          <span class="btn-icon">üîÑ</span> Load Yesterday's Cash
        </button>
        <button class="btn btn-secondary" onclick="app.clearData()">
          <span class="btn-icon">üóëÔ∏è</span> Clear All
        </button>
      </div>
    </section>

    <!-- ========== SALES DATA SECTION ========== -->
    <section class="section-card">
      <div class="section-header">
        <h2 class="section-title">Sales Data</h2>
        <button class="collapse-btn" onclick="app.toggleSection('salesSection')" aria-label="Toggle section">
          <span class="collapse-icon" id="salesSectionIcon">‚ñº</span>
        </button>
      </div>

      <div class="section-content" id="salesSection">
        <!-- Search & Filter Controls -->
        <div class="search-controls">
          <div class="search-box">
            <span class="search-icon">üîç</span>
            <input
              type="search"
              id="productSearch"
              class="search-input"
              placeholder="Search by code or name (Ctrl+F)..."
              oninput="app.filterProducts()"
              onkeydown="if(event.key==='Escape') { this.value=''; app.filterProducts(); }">
          </div>
          <div class="filter-group">
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-size:14px;">
              <input type="checkbox" id="toggleSoldOnly" onchange="app.filterProducts()">
              <span>Show only sold items</span>
            </label>
            <button class="btn-icon-only" onclick="document.getElementById('productSearch').value=''; document.getElementById('toggleSoldOnly').checked=false; app.filterProducts();" title="Clear filters">
              ‚úï
            </button>
          </div>
        </div>

        <!-- Sales Table -->
        <div class="table-responsive">
          <table class="sales-table" id="salesTable">
            <thead>
              <tr>
                <th>Category</th>
                <th>Code</th>
                <th>Item</th>
                <th>Unit</th>
                <th>Price (SAR)</th>
                <th>Qty Sold</th>
                <th>Total (SAR)</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="salesTableBody">
              <!-- Rows will be populated by app.js -->
            </tbody>
            <tfoot>
              <tr style="background:#f3f4f6;font-weight:bold;">
                <td colspan="6" style="text-align:right;">Total Sales Value:</td>
                <td id="totalSalesDisplay">SAR 0.00</td>
                <td><span id="soldCount">0</span> sold</td>
              </tr>
            </tfoot>
          </table>
        </div>

        <div class="section-summary">
          <strong>Total Sales:</strong>
          <span id="totalSalesValue" class="currency-value">SAR 0.00</span>
        </div>
      </div>
    </section>

    <!-- ========== PAYMENT METHODS SECTION ========== -->
    <section class="section-card">
      <div class="section-header">
        <h2 class="section-title">Payment Methods</h2>
        <button class="collapse-btn" onclick="app.toggleSection('paymentsSection')" aria-label="Toggle section">
          <span class="collapse-icon" id="paymentsSectionIcon">‚ñº</span>
        </button>
      </div>

      <div class="section-content" id="paymentsSection">
        <div class="grid-2">
          <!-- Discount -->
          <div class="input-group">
            <label class="input-label negative">(-) Discount (Base)</label>
            <div class="input-wrapper">
              <span class="currency-prefix">SAR</span>
              <input type="number" id="discountBase" class="input-field" step="0.01" value="0" onchange="app.handleDiscountChange()">
            </div>
          </div>
          <div class="input-group">
            <label class="input-label negative">(-) Discount (incl. 15% VAT)</label>
            <div class="input-wrapper">
              <span class="currency-prefix">SAR</span>
              <input type="number" id="discountWithVAT" class="input-field result-field" readonly>
            </div>
          </div>

          <!-- Credit Sales -->
          <div class="input-group">
            <label class="input-label negative">(-) Credit Sales</label>
            <div class="input-wrapper">
              <span class="currency-prefix">SAR</span>
              <input type="number" id="creditSales" class="input-field" step="0.01" value="0" oninput="app.calculateCashBalance()">
            </div>
          </div>

          <!-- Credit Repayment -->
          <div class="input-group">
            <label class="input-label positive">(+) Credit Repayment</label>
            <div class="input-wrapper">
              <span class="currency-prefix">SAR</span>
              <input type="number" id="creditRepayment" class="input-field" step="0.01" value="0" oninput="app.calculateCashBalance()">
            </div>
          </div>

          <!-- Bank POS -->
          <div class="input-group">
            <label class="input-label negative">(-) Bank POS</label>
            <div class="input-wrapper">
              <span class="currency-prefix">SAR</span>
              <input type="number" id="bankPOS" class="input-field" step="0.01" value="0" oninput="app.calculateCashBalance()">
            </div>
          </div>

          <!-- Bank Transfer -->
          <div class="input-group">
            <label class="input-label negative">(-) Bank Transfer</label>
            <div class="input-wrapper">
              <span class="currency-prefix">SAR</span>
              <input type="number" id="bankTransfer" class="input-field" step="0.01" value="0" oninput="app.calculateCashBalance()">
            </div>
          </div>

          <!-- Cheque -->
          <div class="input-group">
            <label class="input-label negative">(-) Cheque</label>
            <div class="input-wrapper">
              <span class="currency-prefix">SAR</span>
              <input type="number" id="cheque" class="input-field" step="0.01" value="0" oninput="app.calculateCashBalance()">
            </div>
          </div>
        </div>

        <div class="section-summary">
          <strong>Expected Cash Balance:</strong>
          <span id="expectedCashBalance" class="currency-value">SAR 0.00</span>
        </div>
      </div>
    </section>

    <!-- ========== CASH COUNT SECTION ========== -->
    <section class="section-card">
      <div class="section-header">
        <h2 class="section-title">Cash Count</h2>
        <button class="collapse-btn" onclick="app.toggleSection('cashCountSection')" aria-label="Toggle section">
          <span class="collapse-icon" id="cashCountSectionIcon">‚ñº</span>
        </button>
      </div>

      <div class="section-content" id="cashCountSection">
        <h3 class="subsection-title">Cash Notes</h3>
        <div class="denominations-grid">

          <!-- 500 SAR Note -->
          <div class="denom-card">
            <div class="denom-header">
              <span class="denom-label">500 SAR</span>
              <span class="denom-total" id="val500">0.00</span>
            </div>
            <div class="denom-controls">
              <button class="quick-btn quick-minus" onclick="app.quickAdd('note500', -1)">-1</button>
              <button class="quick-btn" onclick="app.quickAdd('note500', 1)">+1</button>
              <button class="quick-btn" onclick="app.quickAdd('note500', 5)">+5</button>
              <button class="quick-btn" onclick="app.quickAdd('note500', 10)">+10</button>
            </div>
            <input type="number" class="denom-input" id="note500" min="0" step="1" value="0" oninput="app.calculateCashNotes()">
            <button class="clear-btn" onclick="app.clearDenom('note500')">Clear</button>
          </div>

          <!-- 100 SAR Note -->
          <div class="denom-card">
            <div class="denom-header">
              <span class="denom-label">100 SAR</span>
              <span class="denom-total" id="val100">0.00</span>
            </div>
            <div class="denom-controls">
              <button class="quick-btn quick-minus" onclick="app.quickAdd('note100', -1)">-1</button>
              <button class="quick-btn" onclick="app.quickAdd('note100', 1)">+1</button>
              <button class="quick-btn" onclick="app.quickAdd('note100', 5)">+5</button>
              <button class="quick-btn" onclick="app.quickAdd('note100', 10)">+10</button>
            </div>
            <input type="number" class="denom-input" id="note100" min="0" step="1" value="0" oninput="app.calculateCashNotes()">
            <button class="clear-btn" onclick="app.clearDenom('note100')">Clear</button>
          </div>

          <!-- 50 SAR Note -->
          <div class="denom-card">
            <div class="denom-header">
              <span class="denom-label">50 SAR</span>
              <span class="denom-total" id="val50">0.00</span>
            </div>
            <div class="denom-controls">
              <button class="quick-btn quick-minus" onclick="app.quickAdd('note50', -1)">-1</button>
              <button class="quick-btn" onclick="app.quickAdd('note50', 1)">+1</button>
              <button class="quick-btn" onclick="app.quickAdd('note50', 5)">+5</button>
              <button class="quick-btn" onclick="app.quickAdd('note50', 10)">+10</button>
            </div>
            <input type="number" class="denom-input" id="note50" min="0" step="1" value="0" oninput="app.calculateCashNotes()">
            <button class="clear-btn" onclick="app.clearDenom('note50')">Clear</button>
          </div>

          <!-- 20 SAR Note -->
          <div class="denom-card">
            <div class="denom-header">
              <span class="denom-label">20 SAR</span>
              <span class="denom-total" id="val20">0.00</span>
            </div>
            <div class="denom-controls">
              <button class="quick-btn quick-minus" onclick="app.quickAdd('note20', -1)">-1</button>
              <button class="quick-btn" onclick="app.quickAdd('note20', 1)">+1</button>
              <button class="quick-btn" onclick="app.quickAdd('note20', 5)">+5</button>
              <button class="quick-btn" onclick="app.quickAdd('note20', 10)">+10</button>
            </div>
            <input type="number" class="denom-input" id="note20" min="0" step="1" value="0" oninput="app.calculateCashNotes()">
            <button class="clear-btn" onclick="app.clearDenom('note20')">Clear</button>
          </div>

          <!-- 10 SAR Note -->
          <div class="denom-card">
            <div class="denom-header">
              <span class="denom-label">10 SAR</span>
              <span class="denom-total" id="val10">0.00</span>
            </div>
            <div class="denom-controls">
              <button class="quick-btn quick-minus" onclick="app.quickAdd('note10', -1)">-1</button>
              <button class="quick-btn" onclick="app.quickAdd('note10', 1)">+1</button>
              <button class="quick-btn" onclick="app.quickAdd('note10', 5)">+5</button>
              <button class="quick-btn" onclick="app.quickAdd('note10', 10)">+10</button>
            </div>
            <input type="number" class="denom-input" id="note10" min="0" step="1" value="0" oninput="app.calculateCashNotes()">
            <button class="clear-btn" onclick="app.clearDenom('note10')">Clear</button>
          </div>

          <!-- 5 SAR Note -->
          <div class="denom-card">
            <div class="denom-header">
              <span class="denom-label">5 SAR</span>
              <span class="denom-total" id="val5">0.00</span>
            </div>
            <div class="denom-controls">
              <button class="quick-btn quick-minus" onclick="app.quickAdd('note5', -1)">-1</button>
              <button class="quick-btn" onclick="app.quickAdd('note5', 1)">+1</button>
              <button class="quick-btn" onclick="app.quickAdd('note5', 5)">+5</button>
              <button class="quick-btn" onclick="app.quickAdd('note5', 10)">+10</button>
            </div>
            <input type="number" class="denom-input" id="note5" min="0" step="1" value="0" oninput="app.calculateCashNotes()">
            <button class="clear-btn" onclick="app.clearDenom('note5')">Clear</button>
          </div>

        </div>

        <div class="section-summary">
          <strong>Cash Notes Total:</strong>
          <span id="cashNotes" class="currency-value">SAR 0.00</span>
        </div>

        <h3 class="subsection-title">Coins</h3>
        <div class="denominations-grid">

          <!-- 2 SAR Coin -->
          <div class="denom-card">
            <div class="denom-header">
              <span class="denom-label">2 SAR</span>
              <span class="denom-total" id="valC2">0.00</span>
            </div>
            <div class="denom-controls">
              <button class="quick-btn quick-minus" onclick="app.quickAdd('coin2', -1)">-1</button>
              <button class="quick-btn" onclick="app.quickAdd('coin2', 1)">+1</button>
              <button class="quick-btn" onclick="app.quickAdd('coin2', 5)">+5</button>
              <button class="quick-btn" onclick="app.quickAdd('coin2', 10)">+10</button>
            </div>
            <input type="number" class="denom-input" id="coin2" min="0" step="1" value="0" oninput="app.calculateCoins()">
            <button class="clear-btn" onclick="app.clearDenom('coin2')">Clear</button>
          </div>

          <!-- 1 SAR Coin -->
          <div class="denom-card">
            <div class="denom-header">
              <span class="denom-label">1 SAR</span>
              <span class="denom-total" id="valC1">0.00</span>
            </div>
            <div class="denom-controls">
              <button class="quick-btn quick-minus" onclick="app.quickAdd('coin1', -1)">-1</button>
              <button class="quick-btn" onclick="app.quickAdd('coin1', 1)">+1</button>
              <button class="quick-btn" onclick="app.quickAdd('coin1', 5)">+5</button>
              <button class="quick-btn" onclick="app.quickAdd('coin1', 10)">+10</button>
            </div>
            <input type="number" class="denom-input" id="coin1" min="0" step="1" value="0" oninput="app.calculateCoins()">
            <button class="clear-btn" onclick="app.clearDenom('coin1')">Clear</button>
          </div>

          <!-- 0.50 SAR Coin -->
          <div class="denom-card">
            <div class="denom-header">
              <span class="denom-label">0.50 SAR</span>
              <span class="denom-total" id="valC050">0.00</span>
            </div>
            <div class="denom-controls">
              <button class="quick-btn quick-minus" onclick="app.quickAdd('coin050', -1)">-1</button>
              <button class="quick-btn" onclick="app.quickAdd('coin050', 1)">+1</button>
              <button class="quick-btn" onclick="app.quickAdd('coin050', 5)">+5</button>
              <button class="quick-btn" onclick="app.quickAdd('coin050', 10)">+10</button>
            </div>
            <input type="number" class="denom-input" id="coin050" min="0" step="1" value="0" oninput="app.calculateCoins()">
            <button class="clear-btn" onclick="app.clearDenom('coin050')">Clear</button>
          </div>

          <!-- 0.25 SAR Coin -->
          <div class="denom-card">
            <div class="denom-header">
              <span class="denom-label">0.25 SAR</span>
              <span class="denom-total" id="valC025">0.00</span>
            </div>
            <div class="denom-controls">
              <button class="quick-btn quick-minus" onclick="app.quickAdd('coin025', -1)">-1</button>
              <button class="quick-btn" onclick="app.quickAdd('coin025', 1)">+1</button>
              <button class="quick-btn" onclick="app.quickAdd('coin025', 5)">+5</button>
              <button class="quick-btn" onclick="app.quickAdd('coin025', 10)">+10</button>
            </div>
            <input type="number" class="denom-input" id="coin025" min="0" step="1" value="0" oninput="app.calculateCoins()">
            <button class="clear-btn" onclick="app.clearDenom('coin025')">Clear</button>
          </div>

        </div>

        <div class="section-summary">
          <strong>Coins Total:</strong>
          <span id="coinsTotal" class="currency-value">SAR 0.00</span>
        </div>

        <div class="section-summary" style="background:#eff6ff;padding:12px;border-radius:8px;margin-top:15px;">
          <strong style="font-size:16px;">Actual Cash Total:</strong>
          <span id="actualCashTotal" class="currency-value" style="font-size:18px;color:#2563eb;">SAR 0.00</span>
        </div>
      </div>
    </section>

    <!-- ========== DIFFERENCE INDICATOR ========== -->
    <section class="difference-card balanced" id="differenceIndicator">
      <div class="difference-content">
        <h3 class="difference-title">Cash Difference</h3>
        <div class="difference-amount" id="cashDifference">SAR 0.00</div>
        <div class="difference-status" id="differenceStatus">Enter data to calculate</div>
      </div>
    </section>

    <!-- ========== CHARTS SECTION ========== -->
    <section class="section-card">
      <div class="section-header">
        <h2 class="section-title">Insights</h2>
        <button class="collapse-btn" onclick="app.toggleSection('chartsSection')" aria-label="Toggle section">
          <span class="collapse-icon" id="chartsSectionIcon">‚ñº</span>
        </button>
      </div>

      <div class="section-content collapsed" id="chartsSection">
        <div class="charts-grid">
          <div class="chart-widget">
            <h4>This Week's Sales</h4>
            <canvas id="weekChart" width="400" height="200"></canvas>
            <div class="chart-summary" id="weekSummary">Loading...</div>
          </div>

          <div class="chart-widget">
            <h4>Category Breakdown</h4>
            <canvas id="categoryChart" width="400" height="200"></canvas>
            <div class="chart-summary" id="categorySummary">Loading...</div>
          </div>
        </div>
      </div>
    </section>

    <!-- ========== FINAL SUMMARY ========== -->
    <section class="section-card summary-card">
      <h2 class="section-title">Summary</h2>
      <div class="summary-grid">
        <div class="summary-row">
          <span class="summary-label">Total Sales:</span>
          <span class="summary-value" id="summaryTotalSales">SAR 0.00</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Cash Collected:</span>
          <span class="summary-value" id="summaryCashCollected">SAR 0.00</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Credit Sales:</span>
          <span class="summary-value" id="summaryCreditSales">SAR 0.00</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Bank Deposits:</span>
          <span class="summary-value" id="summaryBankDeposits">SAR 0.00</span>
        </div>
        <div class="summary-row highlight">
          <span class="summary-label">Expected Cash:</span>
          <span class="summary-value" id="summaryExpectedCash">SAR 0.00</span>
        </div>
        <div class="summary-row highlight">
          <span class="summary-label">Actual Cash:</span>
          <span class="summary-value" id="summaryActualCash">SAR 0.00</span>
        </div>
        <div class="summary-row highlight">
          <span class="summary-label">Difference:</span>
          <span class="summary-value" id="summaryDifference">SAR 0.00</span>
        </div>
      </div>
    </section>

    <!-- ========== STATUS MESSAGE ========== -->
    <div class="status-message" id="statusMessage"></div>

    <!-- ========== LOADING OVERLAY ========== -->
    <div id="loadingOverlay" class="loading-overlay hidden">
      <div class="loading-spinner"></div>
    </div>

    <!-- ========== SYNC STATUS ========== -->
    <div class="sync-status">
      <div class="sync-indicator disconnected" id="syncIndicator"></div>
      <span class="sync-text" id="syncText">Connecting...</span>
    </div>

  </div>

  <script src="config.js"></script>
  <script src="app.js"></script>
  <script>
    // Service Worker Registration
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(reg => console.log('Service Worker registered'))
        .catch(err => console.log('Service Worker registration failed:', err));
    }
  </script>
</body>
</html>
